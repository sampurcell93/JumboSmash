// Generated by CoffeeScript 1.6.3
(function() {
  var app, cc, db, express;

  express = require('express');

  app = express();

  app.listen(process.env.PORT || 4040);

  cc = function(arg) {
    return console.log(arg);
  };

  db = require("mongojs").connect(process.env.MONGOHQ_URL || "JumboSmash", ['users']);

  app.configure(function() {
    app.use(express.logger('dev'));
    app.set('views', __dirname + '/views');
    app.set('view engine', 'jade');
    app.use(express.cookieParser());
    app.use(express.bodyParser());
    app.use(express.methodOverride());
    return app.use(express["static"](__dirname + '/public'));
  });

  app.get("/signup", function(req, res, next) {
    return res.render("signup");
  });

  app.post("/signup", function(req, res, next) {
    var click, email, year;
    click = req.body.submit_login;
    email = req.body.email.toLowerCase();
    year = parseInt(req.body.grad_year);
    if (typeof click !== "undefined") {
      db.users.update({
        email: email
      }, {
        $set: {
          email: email,
          grad_year: year
        }
      }, {
        upsert: true
      }, function(err, inserted) {
        if (err || !inserted) {
          return res.redirect("/signup?signup=wrong");
        } else {
          return res.redirect("/signup?signup=right");
        }
      });
      return true;
    }
    return res.redirect("/signup?signup=wrong");
  });

}).call(this);
